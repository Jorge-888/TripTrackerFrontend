<p-card styleClass="create-colaborador-card shadow-2"
    [style]="{ 'border': '1px solid #e9e2db', 'border-radius': '12px', 'background': 'linear-gradient(to bottom, #ffffff 0%, #fafafa 100%)' }">

    <!-- Header -->
    <ng-template pTemplate="header">
        <div style="padding:1.5rem 1.5rem 1rem;">
            <div style="display:flex;align-items:center;gap:0.75rem;margin-bottom:0.5rem;">
                <i class="pi pi-user-plus" style="font-size:1.5rem;color:#875D4A;"></i>
                <h3 style="margin:0;color:#111;font-size:1.5rem;font-weight:600;">Nuevo Colaborador</h3>
            </div>
            <p style="margin:0;color:#64748b;font-size:0.95rem;padding-left:2.25rem;">
                Completa todos los campos para registrar un nuevo colaborador
            </p>
        </div>
    </ng-template>

    <!-- Formulario -->
    <ng-template pTemplate="content">
        <form #f="ngForm" (ngSubmit)="submit(f)">
            <div class="form-grid"
                style="display:grid;grid-template-columns:repeat(3, 1fr);gap:1.5rem;padding:0.5rem 0;">

                <!-- DNI -->
                <div class="field">
                    <label for="dni"
                        style="display:block;margin-bottom:.5rem;color:#334155;font-weight:500;font-size:0.95rem;">
                        DNI <span style="color:#ef4444;">*</span>
                    </label>
                    <p-inputMask id="dni" name="colb_DNI" [(ngModel)]="colaborador.colb_DNI" mask="9999-9999-99999"
                        placeholder="0000-0000-00000" [style]="{ 'width': '100%' }">
                    </p-inputMask>
                </div>

                <!-- Nombres -->
                <div class="field">
                    <label for="nombres"
                        style="display:block;margin-bottom:.5rem;color:#334155;font-weight:500;font-size:0.95rem;">
                        Nombres <span style="color:#ef4444;">*</span>
                    </label>
                    <input id="nombres" name="colb_Nombres" [(ngModel)]="colaborador.colb_Nombres" pInputText
                        placeholder="Ingresa los nombres" [style]="{ 'width': '100%' }" />
                </div>

                <!-- Apellidos -->
                <div class="field">
                    <label for="apellidos"
                        style="display:block;margin-bottom:.5rem;color:#334155;font-weight:500;font-size:0.95rem;">
                        Apellidos <span style="color:#ef4444;">*</span>
                    </label>
                    <input id="apellidos" name="colb_Apellidos" [(ngModel)]="colaborador.colb_Apellidos" pInputText
                        placeholder="Ingresa los apellidos" [style]="{ 'width': '100%' }" />
                </div>

                <!-- Teléfono -->
                <div class="field">
                    <label for="telefono"
                        style="display:block;margin-bottom:.5rem;color:#334155;font-weight:500;font-size:0.95rem;">
                        Teléfono <span style="color:#ef4444;">*</span>
                    </label>
                    <p-inputMask id="telefono" name="colb_Telefono" [(ngModel)]="colaborador.colb_Telefono"
                        mask="9999-9999" placeholder="0000-0000" [style]="{ 'width': '100%' }">
                    </p-inputMask>
                </div>

                <!-- Sexo Toggle -->
                <div class="field">
                    <label for="sexo"
                        style="display:block;margin-bottom:.5rem;color:#334155;font-weight:500;font-size:0.95rem;">
                        Sexo <span style="color:#ef4444;">*</span>
                    </label>
                    <div style="display:flex;gap:0.5rem;">
                        <p-button [label]="'Masculino'" [outlined]="colaborador.colb_Sexo !== 'M'"
                            [raised]="colaborador.colb_Sexo === 'M'" (onClick)="colaborador.colb_Sexo = 'M'" [style]="colaborador.colb_Sexo === 'M' ? { 
                                'background': '#875D4A', 
                                'border-color': '#875D4A',
                                'color': 'white'
                            } : { 
                                'border-color': '#cbd5e1',
                                'color': '#64748b'
                            }">
                        </p-button>
                        <p-button [label]="'Femenino'" [outlined]="colaborador.colb_Sexo !== 'F'"
                            [raised]="colaborador.colb_Sexo === 'F'" (onClick)="colaborador.colb_Sexo = 'F'" [style]="colaborador.colb_Sexo === 'F' ? { 
                                'background': '#875D4A', 
                                'border-color': '#875D4A',
                                'color': 'white'
                            } : { 
                                'border-color': '#cbd5e1',
                                'color': '#64748b'
                            }">
                        </p-button>
                    </div>
                </div>

                <!-- Dirección -->
                <div class="field">
                    <label for="direccion"
                        style="display:block;margin-bottom:.5rem;color:#334155;font-weight:500;font-size:0.95rem;">
                        Dirección <span style="color:#ef4444;">*</span>
                    </label>
                    <input id="direccion" name="colb_Direccion" [(ngModel)]="colaborador.colb_Direccion" pInputText
                        placeholder="Ingresa la dirección" [style]="{ 'width': '100%' }" />
                </div>

                <!-- Estado Civil -->
                <div class="field">
                    <label for="estadoCivil"
                        style="display:block;margin-bottom:.5rem;color:#334155;font-weight:500;font-size:0.95rem;">
                        Estado Civil <span style="color:#ef4444;">*</span>
                    </label>
                    <p-select id="estadoCivil" name="esCi_Id" [(ngModel)]="colaborador.esCi_Id"
                        [options]="estadosCiviles" optionLabel="esCi_Descripcion" optionValue="esCi_Id"
                        placeholder="Selecciona estado civil" [filter]="true" [style]="{ 'width': '100%' }">
                    </p-select>
                </div>

                <!-- Departamento -->
                <div class="field">
                    <label for="departamento"
                        style="display:block;margin-bottom:.5rem;color:#334155;font-weight:500;font-size:0.95rem;">
                        Departamento <span style="color:#ef4444;">*</span>
                    </label>
                    <p-select id="departamento" name="departamento" [(ngModel)]="departamentoSeleccionado"
                        (onChange)="onDepartamentoChange()" [options]="departamentos" optionLabel="depa_Descripcion"
                        optionValue="depa_Codigo" placeholder="Selecciona departamento" [filter]="true"
                        [style]="{ 'width': '100%' }">
                    </p-select>
                </div>

                <!-- Municipio -->
                <div class="field">
                    <label for="municipio"
                        style="display:block;margin-bottom:.5rem;color:#334155;font-weight:500;font-size:0.95rem;">
                        Municipio <span style="color:#ef4444;">*</span>
                    </label>
                    <p-select id="municipio" name="muni_Codigo" [(ngModel)]="colaborador.muni_Codigo"
                        [options]="municipiosFiltrados" optionLabel="muni_Descripcion" optionValue="muni_Codigo"
                        placeholder="Selecciona municipio" [filter]="true" [style]="{ 'width': '100%' }"
                        [disabled]="!departamentoSeleccionado">
                    </p-select>
                </div>

                <!-- Área -->
                <div class="field">
                    <label for="area"
                        style="display:block;margin-bottom:.5rem;color:#334155;font-weight:500;font-size:0.95rem;">
                        Área <span style="color:#ef4444;">*</span>
                    </label>
                    <p-select id="area" name="area_Id" [(ngModel)]="colaborador.area_Id" [options]="areas"
                        optionLabel="area_Descripcion" optionValue="area_Id" placeholder="Selecciona área"
                        [filter]="true" [style]="{ 'width': '100%' }">
                    </p-select>
                </div>

                <!-- Cargo -->
                <div class="field">
                    <label for="cargo"
                        style="display:block;margin-bottom:.5rem;color:#334155;font-weight:500;font-size:0.95rem;">
                        Cargo <span style="color:#ef4444;">*</span>
                    </label>
                    <p-select id="cargo" name="carg_Id" [(ngModel)]="colaborador.carg_Id" [options]="cargos"
                        optionLabel="carg_Descripcion" optionValue="carg_Id" placeholder="Selecciona cargo"
                        [filter]="true" [style]="{ 'width': '100%' }">
                    </p-select>
                </div>
            </div>

            <!-- Sucursales Card -->
            <div style="margin-top:2rem;padding:1.5rem;background:#f8fafc;border-radius:12px;border:1px solid #e2e8f0;">
                <div style="display:flex;align-items:center;gap:0.75rem;margin-bottom:1.5rem;">
                    <i class="pi pi-building" style="font-size:1.25rem;color:#875D4A;"></i>
                    <h4 style="margin:0;color:#111;font-size:1.125rem;font-weight:600;">Sucursales Asignadas</h4>
                    <span style="color:#ef4444;font-size:0.875rem;margin-left:0.25rem;">*</span>
                </div>

                <!-- Agregar Sucursal -->
                <div style="display:grid;grid-template-columns:2fr 1fr auto;gap:1rem;margin-bottom:1.5rem;">
                    <div>
                        <label
                            style="display:block;margin-bottom:.5rem;color:#334155;font-weight:500;font-size:0.9rem;">
                            Sucursal
                        </label>
                        <p-select [(ngModel)]="sucursalSeleccionada" [ngModelOptions]="{standalone: true}"
                            [options]="sucursalesDisponibles" optionLabel="sucu_Descripcion" optionValue="sucu_Id"
                            placeholder="Selecciona sucursal" [filter]="true" [style]="{ 'width': '100%' }">
                        </p-select>
                    </div>

                    <div>
                        <label
                            style="display:block;margin-bottom:.5rem;color:#334155;font-weight:500;font-size:0.9rem;">
                            Distancia (km)
                        </label>
                        <p-inputNumber [(ngModel)]="distanciaSeleccionada" [ngModelOptions]="{standalone: true}"
                            [min]="0" [max]="50" placeholder="0-50 km" [style]="{ 'width': '100%' }" suffix=" km">
                        </p-inputNumber>
                    </div>

                    <div style="display:flex;align-items:flex-end;">
                        <p-button label="Agregar" icon="pi pi-plus" (onClick)="agregarSucursal()"
                            [style]="{ 'background': '#875D4A', 'border-color': '#875D4A' }">
                        </p-button>
                    </div>
                </div>

                <!-- Lista de Sucursales Agregadas -->
                <div *ngIf="sucursalesColaborador.length > 0" style="margin-top:1rem;">
                    <p style="margin:0 0 0.75rem;color:#64748b;font-size:0.9rem;font-weight:500;">
                        Sucursales agregadas ({{ sucursalesColaborador.length }}):
                    </p>
                    <div style="display:flex;flex-direction:column;gap:0.5rem;">
                        <div *ngFor="let suc of sucursalesColaborador; let i = index"
                            style="display:flex;justify-content:space-between;align-items:center;padding:0.75rem 1rem;background:white;border-radius:8px;border:1px solid #e2e8f0;">
                            <div style="display:flex;align-items:center;gap:1rem;">
                                <i class="pi pi-building" style="color:#875D4A;"></i>
                                <span style="color:#334155;font-weight:500;">{{ getSucursalNombre(suc.Sucu_Id) }}</span>
                                <span style="color:#64748b;font-size:0.9rem;">{{ suc.SuCo_DistanciaCasa }} km</span>
                            </div>
                            <p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger"
                                (onClick)="removerSucursal(i)">
                            </p-button>
                        </div>
                    </div>
                </div>

                <div *ngIf="sucursalesColaborador.length === 0" style="text-align:center;padding:2rem;color:#94a3b8;">
                    <i class="pi pi-inbox" style="font-size:2rem;display:block;margin-bottom:0.5rem;"></i>
                    <p style="margin:0;font-size:0.9rem;">No hay sucursales agregadas</p>
                </div>
            </div>

            <!-- Botones -->
            <div
                style="display:flex;gap:0.75rem;justify-content:flex-end;margin-top:2rem;padding-top:1.5rem;border-top:1px solid #e2e8f0;">
                <p-button label="Cancelar" icon="pi pi-times" severity="secondary" [outlined]="true" [rounded]="true"
                    type="button" (onClick)="onCancel()" [style]="{ 'padding': '0.75rem 1.5rem' }">
                </p-button>

                <p-button [label]="saving ? 'Guardando...' : 'Crear Colaborador'"
                    [icon]="saving ? 'pi pi-spin pi-spinner' : 'pi pi-check'" [rounded]="true" [raised]="true"
                    type="submit" [disabled]="saving || loadingData" [style]="{ 
            'background': '#875D4A', 
            'border-color': '#875D4A',
            'padding': '0.75rem 1.5rem',
            'box-shadow': '0 4px 6px -1px rgba(135, 93, 74, 0.2), 0 2px 4px -1px rgba(135, 93, 74, 0.1)'
          }">
                </p-button>
            </div>
        </form>
    </ng-template>
</p-card>

<style>
    /* Form inputs */
    ::ng-deep .create-colaborador-card .p-inputtext,
    ::ng-deep .create-colaborador-card .p-select,
    ::ng-deep .create-colaborador-card .p-inputnumber-input {
        border-radius: 8px;
        border: 1px solid #cbd5e1;
        padding: 0.75rem;
        font-size: 0.95rem;
        transition: all 0.2s ease;
    }

    ::ng-deep .create-colaborador-card .p-inputtext:focus,
    ::ng-deep .create-colaborador-card .p-select:not(.p-disabled):hover,
    ::ng-deep .create-colaborador-card .p-select.p-focus,
    ::ng-deep .create-colaborador-card .p-inputnumber:not(.p-disabled):hover .p-inputnumber-input {
        border-color: #875D4A;
        box-shadow: 0 0 0 3px rgba(135, 93, 74, 0.1);
    }

    /* Toggle switch */
    ::ng-deep .p-inputswitch.p-inputswitch-checked .p-inputswitch-slider {
        background: #875D4A;
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .form-grid {
            grid-template-columns: repeat(2, 1fr) !important;
        }
    }

    @media (max-width: 768px) {
        .form-grid {
            grid-template-columns: 1fr !important;
        }
    }
</style>